{"ast":null,"code":"//import { render, h, Component } from 'preact'\n// var { render, h, Component } = window.preact\nimport React, { Component } from 'react';\nconst h = React.createElement;\nexport var SwiperConfig = {\n  // Behavior\n  // how much of element width to drag to get out\n  outdragFactorLeft: 0.03,\n  outdragFactorRight: 0.03,\n  outdragFactorTop: 0.7,\n  // make veryhard to drag over the top, set to 10+ to make it impossible\n  outdragFactorBottom: 0.3,\n  // Positioning\n  top: 40,\n  // __must__ be in pixels or the math will fail\n  left: 70,\n  width: 200,\n  height: 300,\n  // Card design\n  cardPosition: 'fixed',\n  // can be 'absolute'\n  cardShade: 'rgb(240,243,234)',\n  cardBorderRadius: '3mm',\n  cardBorderLight: '0px solid #998',\n  cardBorderDark: '1.1px solid #662',\n  // Card being swiped (when it moves)\n  cardOpacity: 0.9,\n  swipeShadow: '0px 15px 30px rgba(0,.5,.0,0.5)',\n  // Stack drawing\n  stackBorder: '0.5px dotted #663',\n  stackMax: 8,\n  stackStep: 0.7,\n  stackRotation: 7,\n  stackStepX: 0.9,\n  stackStepY: 1.8,\n  stackShadowColor: 'rgba(.5,.5,.0,0.5)'\n};\nexport function freezeElement(el, freeze) {\n  console.log('>>>>>>>>>>>>>>>>>>>>>>>freezeEl', el);\n\n  if (freeze) {\n    el.style.userSelect = 'none';\n    el.style['-moz-user-select'] = 'none';\n  } else {\n    el.style.userSelect = null;\n    el.style['-moz-user-select'] = null;\n  }\n}\n\nfunction animateElement(el, start) {\n  // var elem =document.getElementById(\"myH1\")\n  console.log('>>>>>>>>>>>>>>>>>>>>>>>animEl', el);\n  freezeElement(el, start); // disable the cards content and apply styles effective during animation\n\n  if (start) {\n    el.style.opacity = SwiperConfig.cardOpacity;\n    el.style.boxShadow = SwiperConfig.swipeShadow;\n  } else {\n    el.style.opacity = 1;\n    el.style.boxShadow = null;\n    el.style.transform = null;\n  }\n}\n\nfunction calculateDragout(state) {\n  // returns bitmask: 0: not dragged enough to get out\n  // 1: left, 2: right, 4: up, 8: down, combine like left-up = 1+4 = 5\n  var outdragLeft = SwiperConfig.outdragFactorLeft * state.width;\n  var outdragRight = SwiperConfig.outdragFactorRight * state.width;\n  var outdragTop = SwiperConfig.outdragFactorTop * state.width;\n  var outdragBottom = SwiperConfig.outdragFactorBottom * state.width;\n  var bitmask = 0;\n  if (state.left < state.startX - outdragLeft) bitmask += 1;\n  if (state.left > state.startX + outdragRight) bitmask += 2;\n  if (state.top < state.startY - outdragTop) bitmask += 4;\n  if (state.top > state.startY + outdragBottom) bitmask += 8;\n  return {\n    bitmask,\n    outdrag: state.left - state.startX\n  };\n}\n\nexport function DrawStacks(stackSize) {\n  // Draw cards edges that represent the stack under our visible two cards.\n  if (stackSize > SwiperConfig.stackMax) stackSize = SwiperConfig.stackMax;\n\n  function Stack(props) {\n    // draw stack depending on number of cards left\n    var StackStyle = {\n      position: 'absolute',\n      width: SwiperConfig.width,\n      height: SwiperConfig.height,\n      left: SwiperConfig.left + props.i * SwiperConfig.stackStepX,\n      top: SwiperConfig.top + props.i * SwiperConfig.stackStepY,\n      borderRadius: SwiperConfig.cardBorderRadius,\n      backgroundColor: SwiperConfig.cardShade,\n      border: SwiperConfig.stackBorder,\n      zIndex: 1002\n    };\n\n    if (SwiperConfig.stackRotation != undefined) {\n      StackStyle.transform = `rotate(${props.i / SwiperConfig.stackRotation}deg)`;\n    }\n\n    if (props.last == true && SwiperConfig.stackShadowColor != undefined) {\n      var X = stackSize * SwiperConfig.stackStepX * 1.1;\n      var Y = stackSize * SwiperConfig.stackStepY * 1.1;\n      StackStyle.boxShadow = `${X}px ${Y}px 10px ` + SwiperConfig.stackShadowColor;\n    }\n\n    return h('div', {\n      style: StackStyle\n    });\n  }\n\n  if (stackSize <= 1) return [];\n  var R = [];\n\n  for (var i = stackSize; i >= 0; i -= SwiperConfig.stackStep) {\n    R.push(i);\n  }\n\n  for (var i = 0; i < R.length; i++) {\n    R[i] = h(Stack, {\n      i: R[i],\n      last: i == R.length - 1\n    });\n  }\n\n  return R;\n}\n\nclass TopCard extends Component {\n  constructor(props) {\n    super(props);\n    this.touch = this.touch.bind(this);\n    this.move = this.move.bind(this);\n    this.release = this.release.bind(this);\n    this.getCurrentDragout = this.getCurrentDragout.bind(this);\n  }\n\n  getCurrentDragout() {\n    console.log('>>>>>>>>>>>>>getCurrentDragout', this);\n    var top = parseInt(this.node.style.top);\n    var left = parseInt(this.node.style.left);\n    var width = this.base.clientWidth;\n    var height = this.base.clientHeight;\n    var {\n      startX,\n      startY\n    } = this.track;\n    return calculateDragout({\n      top,\n      left,\n      width,\n      height,\n      startX,\n      startY\n    });\n  }\n\n  touch(e) {\n    this.track = {\n      dragout: 0,\n      holdX: e.pageX,\n      holdY: e.pageY,\n      // mark >>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>\n      // startX: parseInt(this.node.style.left),\n      // startY: parseInt(this.node.style.top),\n      startX: parseInt(e.target.style.left),\n      startY: parseInt(e.target.style.top)\n    };\n\n    if (this.userComponent.on_dragbegin) {\n      animateElement(this.node, true);\n      this.userComponent.on_dragbegin();\n    }\n\n    if (this.userComponent.on_dragstate) {\n      this.userComponent.on_dragstate(0, -1);\n    }\n  }\n\n  move(e) {\n    // >>>>>>>>>>>>>>>>>>>>>>>>>>>>>..mark\n    // var S = this.node.style\n    var S = e.target.style;\n    console.log('SSSSSSSSSSSSSSSSSSSSSSSSSSsss', S);\n    S.cursor = 'grabbing';\n    S.left = parseInt(S.left) + e.pageX - this.track.holdX + 'px';\n    S.top = parseInt(S.top) + e.pageY - this.track.holdY + 'px';\n    this.track.holdX = e.pageX;\n    this.track.holdY = e.pageY;\n    var calc = this.getCurrentDragout();\n    this.base.style.transform = `rotate(${calc.outdrag / 15}deg)`;\n    var new_dragout = calc.bitmask;\n\n    if (new_dragout != this.track.dragout) {\n      if (this.props.on_dragstate) {\n        this.props.on_dragstate(new_dragout, this.track.dragout);\n      }\n\n      if (this.userComponent.on_dragstate) {\n        this.userComponent.on_dragstate(new_dragout, this.track.dragout);\n      }\n\n      this.track.dragout = new_dragout;\n    }\n  }\n\n  release() {\n    console.log('>>>>>>>>>>>>>>this el', el); // animateElement(el, false)\n\n    animateElement(el, false);\n    var S = el.style;\n    S.cursor = 'auto';\n    var dragout = this.getCurrentDragout().bitmask;\n\n    if (dragout == 0) {\n      S.left = this.track.startX;\n      S.top = this.track.startY;\n    } else {\n      this.props.nextcard(dragout);\n    }\n\n    this.track = undefined;\n\n    if (this.userComponent.on_dragend) {\n      this.userComponent.on_dragend(dragout);\n    }\n  }\n\n  render() {\n    var Card = h(this.props.Card, {\n      data: this.props.data,\n      itemData: this.props.itemData,\n      userData: this.props.userData,\n      number: this.props.number,\n      ref: x => {\n        this.userComponent = x;\n      }\n    });\n    return h('div', {\n      onTouchStart: e => {\n        this.touch(e.touches[0]);\n      },\n      onMouseDown: e => {\n        e.preventDefault();\n        this.touch(e);\n      },\n      onMouseMove: e => {\n        if (this.track) this.move(e);\n      },\n      onTouchMove: e => {\n        e.preventDefault();\n        if (this.track) this.move(e.touches[0]);\n      },\n      onMouseUp: e => {\n        if (this.track) this.release(e.target);\n      },\n      onTouchEnd: e => {\n        if (this.track) this.release(e.touches[0]);\n      },\n      onMouseLeave: e => {\n        if (this.track) this.release(e.target);\n      },\n      style: {\n        backgroundImage: `linear-gradient(290deg, ${SwiperConfig.cardShade}, white, white)`,\n        borderRadius: SwiperConfig.cardBorderRadius,\n        borderTop: SwiperConfig.cardBorderLight,\n        borderLeft: SwiperConfig.cardBorderLight,\n        borderRight: SwiperConfig.cardBorderDark,\n        borderBottom: SwiperConfig.cardBorderDark,\n        width: SwiperConfig.width,\n        height: SwiperConfig.height,\n        cursor: 'auto',\n        position: SwiperConfig.cardPosition,\n        top: SwiperConfig.top,\n        left: SwiperConfig.left,\n        zIndex: 1003\n      }\n    }, Card);\n  }\n\n}\n\nexport class PitchSwiper extends Component {\n  constructor(props) {\n    super(props);\n    this.nextcard = this.nextcard.bind(this);\n    this.state = {\n      current: 0\n    };\n  }\n\n  nextcard(bitmask) {\n    if (this.background.on_card) {\n      this.background.on_card(bitmask, this.state.current, this.props.data[this.state.current], this.props.data);\n    }\n\n    this.setState({\n      current: this.state.current + 1\n    });\n  }\n\n  render() {\n    var Make = N => {\n      if (N >= this.props.data.length) {\n        return h('div', {}, '');\n      }\n\n      return h(TopCard, {\n        itemData: this.props.data[N],\n        data: this.props.data,\n        key: N,\n        Card: this.props.Card,\n        number: N,\n        on_dragstate: this.props.on_dragstate,\n        nextcard: this.nextcard,\n        userData: this.props.userData\n      });\n    };\n\n    return h('div', {}, Make(this.state.current + 1), Make(this.state.current), h(this.props.Background, {\n      ref: e => {\n        this.background = e;\n      },\n      data: this.props.data,\n      number: this.state.current,\n      itemData: this.props.data[this.state.current],\n      userData: this.props.userData\n    }), DrawStacks(this.props.data.length - this.state.current));\n  }\n\n}","map":{"version":3,"sources":["/home/denis/nextPWA/swip/components/swipper.js"],"names":["React","Component","h","createElement","SwiperConfig","outdragFactorLeft","outdragFactorRight","outdragFactorTop","outdragFactorBottom","top","left","width","height","cardPosition","cardShade","cardBorderRadius","cardBorderLight","cardBorderDark","cardOpacity","swipeShadow","stackBorder","stackMax","stackStep","stackRotation","stackStepX","stackStepY","stackShadowColor","freezeElement","el","freeze","console","log","style","userSelect","animateElement","start","opacity","boxShadow","transform","calculateDragout","state","outdragLeft","outdragRight","outdragTop","outdragBottom","bitmask","startX","startY","outdrag","DrawStacks","stackSize","Stack","props","StackStyle","position","i","borderRadius","backgroundColor","border","zIndex","undefined","last","X","Y","R","push","length","TopCard","constructor","touch","bind","move","release","getCurrentDragout","parseInt","node","base","clientWidth","clientHeight","track","e","dragout","holdX","pageX","holdY","pageY","target","userComponent","on_dragbegin","on_dragstate","S","cursor","calc","new_dragout","nextcard","on_dragend","render","Card","data","itemData","userData","number","ref","x","onTouchStart","touches","onMouseDown","preventDefault","onMouseMove","onTouchMove","onMouseUp","onTouchEnd","onMouseLeave","backgroundImage","borderTop","borderLeft","borderRight","borderBottom","PitchSwiper","current","background","on_card","setState","Make","N","key","Background"],"mappings":"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","sourcesContent":["//import { render, h, Component } from 'preact'\n// var { render, h, Component } = window.preact\n\nimport React, { Component } from 'react'\n\nconst h = React.createElement\n\nexport var SwiperConfig = {\n  // Behavior\n\n  // how much of element width to drag to get out\n  outdragFactorLeft: 0.03,\n  outdragFactorRight: 0.03,\n  outdragFactorTop: 0.7, // make veryhard to drag over the top, set to 10+ to make it impossible\n  outdragFactorBottom: 0.3,\n\n  // Positioning\n  top: 40, // __must__ be in pixels or the math will fail\n  left: 70,\n  width: 200,\n  height: 300,\n\n  // Card design\n  cardPosition: 'fixed', // can be 'absolute'\n  cardShade: 'rgb(240,243,234)',\n  cardBorderRadius: '3mm',\n  cardBorderLight: '0px solid #998',\n  cardBorderDark: '1.1px solid #662',\n\n  // Card being swiped (when it moves)\n  cardOpacity: 0.9,\n  swipeShadow: '0px 15px 30px rgba(0,.5,.0,0.5)',\n\n  // Stack drawing\n  stackBorder: '0.5px dotted #663',\n  stackMax: 8,\n  stackStep: 0.7,\n  stackRotation: 7,\n  stackStepX: 0.9,\n  stackStepY: 1.8,\n  stackShadowColor: 'rgba(.5,.5,.0,0.5)',\n}\n\nexport function freezeElement(el, freeze) {\n  console.log('>>>>>>>>>>>>>>>>>>>>>>>freezeEl', el)\n\n  if (freeze) {\n    el.style.userSelect = 'none'\n    el.style['-moz-user-select'] = 'none'\n  } else {\n    el.style.userSelect = null\n    el.style['-moz-user-select'] = null\n  }\n}\n\nfunction animateElement(el, start) {\n  // var elem =document.getElementById(\"myH1\")\n  console.log('>>>>>>>>>>>>>>>>>>>>>>>animEl', el)\n  freezeElement(el, start)\n\n  // disable the cards content and apply styles effective during animation\n  if (start) {\n    el.style.opacity = SwiperConfig.cardOpacity\n    el.style.boxShadow = SwiperConfig.swipeShadow\n  } else {\n    el.style.opacity = 1\n    el.style.boxShadow = null\n    el.style.transform = null\n  }\n}\n\nfunction calculateDragout(state) {\n  // returns bitmask: 0: not dragged enough to get out\n  // 1: left, 2: right, 4: up, 8: down, combine like left-up = 1+4 = 5\n\n  var outdragLeft = SwiperConfig.outdragFactorLeft * state.width\n  var outdragRight = SwiperConfig.outdragFactorRight * state.width\n  var outdragTop = SwiperConfig.outdragFactorTop * state.width\n  var outdragBottom = SwiperConfig.outdragFactorBottom * state.width\n  var bitmask = 0\n  if (state.left < state.startX - outdragLeft) bitmask += 1\n  if (state.left > state.startX + outdragRight) bitmask += 2\n  if (state.top < state.startY - outdragTop) bitmask += 4\n  if (state.top > state.startY + outdragBottom) bitmask += 8\n  return { bitmask, outdrag: state.left - state.startX }\n}\n\nexport function DrawStacks(stackSize) {\n  // Draw cards edges that represent the stack under our visible two cards.\n  if (stackSize > SwiperConfig.stackMax) stackSize = SwiperConfig.stackMax\n\n  function Stack(props) {\n    // draw stack depending on number of cards left\n    var StackStyle = {\n      position: 'absolute',\n      width: SwiperConfig.width,\n      height: SwiperConfig.height,\n      left: SwiperConfig.left + props.i * SwiperConfig.stackStepX,\n      top: SwiperConfig.top + props.i * SwiperConfig.stackStepY,\n      borderRadius: SwiperConfig.cardBorderRadius,\n      backgroundColor: SwiperConfig.cardShade,\n      border: SwiperConfig.stackBorder,\n      zIndex: 1002,\n    }\n\n    if (SwiperConfig.stackRotation != undefined) {\n      StackStyle.transform = `rotate(${\n        props.i / SwiperConfig.stackRotation\n      }deg)`\n    }\n\n    if (props.last == true && SwiperConfig.stackShadowColor != undefined) {\n      var X = stackSize * SwiperConfig.stackStepX * 1.1\n      var Y = stackSize * SwiperConfig.stackStepY * 1.1\n      StackStyle.boxShadow =\n        `${X}px ${Y}px 10px ` + SwiperConfig.stackShadowColor\n    }\n\n    return h('div', { style: StackStyle })\n  }\n\n  if (stackSize <= 1) return []\n  var R = []\n  for (var i = stackSize; i >= 0; i -= SwiperConfig.stackStep) {\n    R.push(i)\n  }\n  for (var i = 0; i < R.length; i++) {\n    R[i] = h(Stack, { i: R[i], last: i == R.length - 1 })\n  }\n\n  return R\n}\n\nclass TopCard extends Component {\n  constructor(props) {\n    super(props)\n    this.touch = this.touch.bind(this)\n    this.move = this.move.bind(this)\n    this.release = this.release.bind(this)\n    this.getCurrentDragout = this.getCurrentDragout.bind(this)\n  }\n\n  getCurrentDragout() {\n    console.log('>>>>>>>>>>>>>getCurrentDragout', this)\n    var top = parseInt(this.node.style.top)\n    var left = parseInt(this.node.style.left)\n    var width = this.base.clientWidth\n    var height = this.base.clientHeight\n    var { startX, startY } = this.track\n\n    return calculateDragout({ top, left, width, height, startX, startY })\n  }\n\n  touch(e) {\n    this.track = {\n      dragout: 0,\n      holdX: e.pageX,\n      holdY: e.pageY,\n\n      // mark >>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>\n      // startX: parseInt(this.node.style.left),\n      // startY: parseInt(this.node.style.top),\n      startX: parseInt(e.target.style.left),\n      startY: parseInt(e.target.style.top),\n    }\n    if (this.userComponent.on_dragbegin) {\n      animateElement(this.node, true)\n      this.userComponent.on_dragbegin()\n    }\n    if (this.userComponent.on_dragstate) {\n      this.userComponent.on_dragstate(0, -1)\n    }\n  }\n\n  move(e) {\n    // >>>>>>>>>>>>>>>>>>>>>>>>>>>>>..mark\n    // var S = this.node.style\n    var S = e.target.style\n    console.log('SSSSSSSSSSSSSSSSSSSSSSSSSSsss', S)\n    S.cursor = 'grabbing'\n    S.left = parseInt(S.left) + e.pageX - this.track.holdX + 'px'\n    S.top = parseInt(S.top) + e.pageY - this.track.holdY + 'px'\n\n    this.track.holdX = e.pageX\n    this.track.holdY = e.pageY\n    var calc = this.getCurrentDragout()\n\n    this.base.style.transform = `rotate(${calc.outdrag / 15}deg)`\n    var new_dragout = calc.bitmask\n    if (new_dragout != this.track.dragout) {\n      if (this.props.on_dragstate) {\n        this.props.on_dragstate(new_dragout, this.track.dragout)\n      }\n      if (this.userComponent.on_dragstate) {\n        this.userComponent.on_dragstate(new_dragout, this.track.dragout)\n      }\n      this.track.dragout = new_dragout\n    }\n  }\n\n  release() {\n    console.log('>>>>>>>>>>>>>>this el', el)\n\n    // animateElement(el, false)\n    animateElement(el, false)\n    var S = el.style\n    S.cursor = 'auto'\n    var dragout = this.getCurrentDragout().bitmask\n    if (dragout == 0) {\n      S.left = this.track.startX\n      S.top = this.track.startY\n    } else {\n      this.props.nextcard(dragout)\n    }\n    this.track = undefined\n    if (this.userComponent.on_dragend) {\n      this.userComponent.on_dragend(dragout)\n    }\n  }\n\n  render() {\n    var Card = h(this.props.Card, {\n      data: this.props.data,\n      itemData: this.props.itemData,\n      userData: this.props.userData,\n      number: this.props.number,\n      ref: (x) => {\n        this.userComponent = x\n      },\n    })\n\n    return h(\n      'div',\n      {\n        onTouchStart: (e) => {\n          this.touch(e.touches[0])\n        },\n        onMouseDown: (e) => {\n          e.preventDefault()\n          this.touch(e)\n        },\n        onMouseMove: (e) => {\n          if (this.track) this.move(e)\n        },\n        onTouchMove: (e) => {\n          e.preventDefault()\n          if (this.track) this.move(e.touches[0])\n        },\n        onMouseUp: (e) => {\n          if (this.track) this.release(e.target)\n        },\n        onTouchEnd: (e) => {\n          if (this.track) this.release(e.touches[0])\n        },\n        onMouseLeave: (e) => {\n          if (this.track) this.release(e.target)\n        },\n        style: {\n          backgroundImage: `linear-gradient(290deg, ${SwiperConfig.cardShade}, white, white)`,\n          borderRadius: SwiperConfig.cardBorderRadius,\n          borderTop: SwiperConfig.cardBorderLight,\n          borderLeft: SwiperConfig.cardBorderLight,\n          borderRight: SwiperConfig.cardBorderDark,\n          borderBottom: SwiperConfig.cardBorderDark,\n          width: SwiperConfig.width,\n          height: SwiperConfig.height,\n          cursor: 'auto',\n          position: SwiperConfig.cardPosition,\n          top: SwiperConfig.top,\n          left: SwiperConfig.left,\n          zIndex: 1003,\n        },\n      },\n      Card\n    )\n  }\n}\n\nexport class PitchSwiper extends Component {\n  constructor(props) {\n    super(props)\n    this.nextcard = this.nextcard.bind(this)\n    this.state = {\n      current: 0,\n    }\n  }\n\n  nextcard(bitmask) {\n    if (this.background.on_card) {\n      this.background.on_card(\n        bitmask,\n        this.state.current,\n        this.props.data[this.state.current],\n        this.props.data\n      )\n    }\n    this.setState({ current: this.state.current + 1 })\n  }\n\n  render() {\n    var Make = (N) => {\n      if (N >= this.props.data.length) {\n        return h('div', {}, '')\n      }\n      return h(TopCard, {\n        itemData: this.props.data[N],\n        data: this.props.data,\n        key: N,\n        Card: this.props.Card,\n        number: N,\n        on_dragstate: this.props.on_dragstate,\n        nextcard: this.nextcard,\n        userData: this.props.userData,\n      })\n    }\n\n    return h(\n      'div',\n      {},\n      Make(this.state.current + 1),\n      Make(this.state.current),\n      h(this.props.Background, {\n        ref: (e) => {\n          this.background = e\n        },\n        data: this.props.data,\n        number: this.state.current,\n        itemData: this.props.data[this.state.current],\n        userData: this.props.userData,\n      }),\n      DrawStacks(this.props.data.length - this.state.current)\n    )\n  }\n}\n"]},"metadata":{},"sourceType":"module"}